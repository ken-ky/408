### 一条指令的实现

#### 命题风格

+ 中括号，里面表示寄存器编号、或主存地址
+ 使用寄存器里内容不加小括号，直接给寄存器名称
+ 2022年之后硬布线、微程序控制器删除



#### 大题考察范围

+ CPU=控制器（CU）+数据通路（指令执行部件，包括运算器、储存器、数据传输通路等）
+ 指令执行过程：
  + 取指、译码
    + 取指令送入IR、PC+“1”
    + CU根据IR译码，确定指令执行时序
  + 执行
    + 取操作数、运算、存结果
    + 异常/中断的检测与处理



#### 分析过程

+ 取指阶段
  + 根据PC内容，从主存取指令到IR
    + PC->MAR
    + M(MAR)【给主存发“读”信号】->MDR（指令）->IR
  + PC+“1”（可用ALU、加法器、自增功能寄存器实现）【注意“1”的大小，与指令字长、编址方式（一般按字节编址）有关】
  
+ 译码阶段

+ 执行阶段
  + 数据传送类指令（关注数据流向）【mov load store等】
    + 数据来源：寄存器、主存和立即数
      + 地址->MAR
      + M(MAR)->MDR->目的地（读过程）
      
    + 流向：
      + 寄存器->暂存寄存器（规避总线冲突【某条指令子步骤】）
      
    + 子步骤问题：
    
      1. 寄存器->寄存器
      2. 寄存器->主存
      3. 主存->寄存器
      4. 立即数->寄存器
      5. 立即数->主存
      6. 寄存器->暂存寄存器
    
      【注】关注总线占用（总线临界资源）（安排控制信号）
    
  + 运算类指令
    + 运算类指令
      + 加/减（ALU、加法器、自增（减）寄存器）
      + 乘法（ALU【支持乘法与移位】、乘法器、移位功能寄存器【$\times2^n$类型乘法】）
      + 除法（ALU、除法器、移位功能寄存器【$/2^n$类型乘法】）
      + 移位运算（ALU、移位功能寄存器（SR））
      + 与、或、异或等双操作数逻辑运算（ALU）
      + 非（ALU【只需一端有输入】、带取反功能寄存器）
      + 短数->长数扩展（带“零扩展”和“符号扩展”的寄存器）
    
  + 转移类指令：改变PC值
    + 条件转移类：有前置cmp（本质是减法A-B，生成CF、ZF、OF、SF、NF），根据标志位判断是否转移【13年真题、09年】
      + 如果要转移：
        + 注意指令寻址方式：相对寻址（PC+偏移量）、直接寻址（少见）
        + 注意PC值：以字节为单位（PC+2）、以指令字为单位（PC+1）